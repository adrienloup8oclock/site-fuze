(function($, window, undefined) {

	'use strict';

    var App = {

      init: function() {

        var _this = this;

        this.$win        = $(window);
        this.$doc        = $(document);
        this.$html       = $('html');
        this.$body       = $('body');
        this.$navigation = $('#navigation');
        this.$menu       = $('#menu');
        this.$under      = $('#under');
        this.$sober      = $('#sober');
        this.$article    = $('#article');
        this.$moreinfo   = $('#moreinfo');

        this.winH = 0;
        this.winW = 0;

        this.$win.on('resize', function(){
          _this.onResize();
        });

        this.$win.on('scroll', function(){
          _this.onScroll();
        });

        this.start();
        this.tooltip();
        this.anchor();
        this.moredetails();
        this.fillorfit();
        this.navigation();

      },

      start: function(){

        console.log( '__START' );

        var _this = this;

        setTimeout(function(){ _this.$html.addClass('loaded') }, 2000);

      },

      toolstip: function(){

        var _this = this;

        this.$moreinfo.find('.call').on('click', function(){

          var parent = $(this).parent();

          if( parent.hasClass('active') ) {
            _this.$moreinfo.find('ul li').removeClass('active');
          } else {
            _this.$moreinfo.find('ul li').removeClass('active');
            parent.addClass('active');
          }

        });

      },

      anchor: function(){

        var $root = $('html, body');

        this.$body.find('.anchor').on('click', function(){
          $root.animate({ scrollTop: $( $.attr(this, 'href') ).offset().top }, 500, 'swing');
          return false;
        });

      },

      moredetails: function(){

        this.$article.find('.callmoreinfo').on('click', function(){

          var self = $(this),
          height = self.find('.moredetails').innerHeight();

          if( self.hasClass('active') ) {
              self.find('.figcaption').attr('style', '');
              setTimeout(function(){ self.removeClass('active') }, 100);
          } else {
              self.find('.figcaption').css({ height: height + 30 + 'px'});
              setTimeout(function(){ self.addClass('active') }, 100);
          }

        });

      },

      fillorfit: function() {

        var nbLoaded = 0;
        var nbImg = $('.fillorfit').length;
        var resizeTimer = null;

        if( $('.fillorfit').length ) {

          var $fillorfit = $('.fillorfit'), vertical, horizontal;

          $fillorfit.each(function() {

            var _this = $(this);
            vertical = _this.data('vertical') || 'center';
            horizontal = _this.data('horizontal') || 'center';

            _this.fillorfit({
              method:          'fill',     // fill/fit
              verticalAlign:   vertical,   // top/bottom/center
              horizontalAlign: horizontal, // left/right/center
              maxWidth:        'initial',  // px || 'initial'
              maxHeight:       'initial',  // px || 'initial'
              afterResize:     function(){},
            }, function(){});

          });

        }

      },

      navigation: function(){

        var _this = this, check = false, counter, $parent, index, submenuH;

        this.$navigation.find('ul li span').on('click', function(e){
          e.preventDefault();

          clearTimeout(counter);

          $parent  = $(this).parent(),
          index    = $parent.index(),
          submenuH = _this.$menu.find('.submenu').eq(index).innerHeight();

          ($parent.hasClass('active')) ? closeMenu() : openMenu();

        });
        
        this.$under.on('mouseenter', function(){
          if(check)
            counter = setTimeout(function(){ closeMenu() }, 1500)
        });

        this.$sober.on('mouseenter', function(){
          clearTimeout(counter);
        });

        function closeMenu(){
          _this.$navigation.find('ul li').removeClass('active');
          _this.$under.css({
            '-webkit-transform': 'translateY(0px) translateZ(0)',
            '-moz-transform'   : 'translateY(0px) translateZ(0)',
            '-ms-transform'    : 'translateY(0px) translateZ(0)',
            '-o-transform'     : 'translateY(0px) translateZ(0)',
            'transform'        : 'translateY(0px) translateZ(0)'
          });
          _this.$article.css({
            '-webkit-transform': 'translateY(0px) translateZ(0)',
            '-moz-transform'   : 'translateY(0px) translateZ(0)',
            '-ms-transform'    : 'translateY(0px) translateZ(0)',
            '-o-transform'     : 'translateY(0px) translateZ(0)',
            'transform'        : 'translateY(0px) translateZ(0)'
          });
          // _this.$article.animate({ 'top': '0px' }, 550, function() {});

          _this.$menu.find('.submenu').removeClass('active');
        }

        function openMenu(){
          check = true;
          _this.$navigation.find('ul li').removeClass('active');
          $parent.addClass('active');
          _this.$under.css({
            '-webkit-transform': 'translateY(' + submenuH + 'px) translateZ(0)',
            '-moz-transform'   : 'translateY(' + submenuH + 'px) translateZ(0)',
            '-ms-transform'    : 'translateY(' + submenuH + 'px) translateZ(0)',
            '-o-transform'     : 'translateY(' + submenuH + 'px) translateZ(0)',
            'transform'        : 'translateY(' + submenuH + 'px) translateZ(0)'
          });
          _this.$article.css({
            '-webkit-transform': 'translate(0, ' + submenuH + 'px) translateZ(0)',
            '-moz-transform'   : 'translate(0, ' + submenuH + 'px) translateZ(0)',
            '-ms-transform'    : 'translate(0, ' + submenuH + 'px) translateZ(0)',
            '-o-transform'     : 'translate(0, ' + submenuH + 'px) translateZ(0)',
            'transform'        : 'translate(0, ' + submenuH + 'px) translateZ(0)'
          });
          _this.$menu.find('.submenu').removeClass('active');
          _this.$menu.find('.submenu').eq(index).addClass('active');
        }

      },

      onResize: function(){

        this.winW = this.$win.width();
        this.winH = this.$win.height();

        //console.log( this.winW, this.winH );

      },

      onScroll: function(){

        //console.log( this.$win.scrollTop() );

        this.$navigation.find('ul li').removeClass('active');
        this.$menu.find('.submenu').removeClass('active');
        this.$under.css({
          '-webkit-transform': 'translateY(0px) translateZ(0)',
          '-moz-transform'   : 'translateY(0px) translateZ(0)',
          '-ms-transform'    : 'translateY(0px) translateZ(0)',
          '-o-transform'     : 'translateY(0px) translateZ(0)',
          'transform'        : 'translateY(0px) translateZ(0)'
        });
        this.$article.css({
          '-webkit-transform': 'translateY(0px) translateZ(0)',
          '-moz-transform'   : 'translateY(0px) translateZ(0)',
          '-ms-transform'    : 'translateY(0px) translateZ(0)',
          '-o-transform'     : 'translateY(0px) translateZ(0)',
          'transform'        : 'translateY(0px) translateZ(0)'
        });
        this.$moreinfo.find('ul li').removeClass('active');
      }

    };

    $(document).ready(function(){
        App.init();
    });

})(jQuery, window);